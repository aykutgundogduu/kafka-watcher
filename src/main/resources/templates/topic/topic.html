<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">

<th:block layout:fragment="pagetitle">
	<!--page title-->
	<div th:replace="~{partials/title-meta :: title-meta('Kafka Cluster Dashboard')}"></div>
</th:block>

<head>
	<link href="/assets/libs/swiper/swiper-bundle.min.css" rel="stylesheet" />

</head>

<body>
	<div layout:fragment="content" th:if="${topic}">
		<h5 class="mb-12" >Topic Details - <span th:text="${topic.getTopicName()}"></span></h5>

		<!--Multiple tab-->
		<div class="col-xxl-12" th:if="${topic}">
			<!-- Nav tabs -->
			<ul class="nav nav-pills nav-customs nav-danger mb-12" role="tablist">
				<li class="nav-item">
					<a class="nav-link active" data-bs-toggle="tab" href="#topic-dashboard-nav-nodes"
						role="tab">Partitions</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-bs-toggle="tab" href="#topic-dashboard-nav-metrics"
						role="tab">Metrics</a>
				</li>
			</ul><!-- Tab panes -->
			<div class="tab-content text-muted">
				<!--Partitions-->
				<div class="tab-pane active" id="topic-dashboard-nav-nodes" role="tabpanel">
					<!--Widgets-->
					<div class="row">
						<div class="col-xl-12">
							<div class="card crm-widget">
								<div class="card-body p-0">
									<div class="row row-cols-md-3 row-cols-1">
										<div class="col col-lg border-end">
											<div class="py-4 px-3">
												<h5 class="text-muted text-uppercase fs-13">Partitions</i>
												</h5>
												<div class="d-flex align-items-center">
													<div class="flex-shrink-0">
														<i class="ri-pie-chart-line display-6 text-muted"></i>
													</div>
													<div class="flex-grow-1 ms-3">
														<h2 class="mb-0"><span class="counter-value" th:data-target="${topic.getPartitions().size()}">0</span></h2>
													</div>
												</div>
											</div>
										</div><!-- end col -->
										<div class="col col-lg border-end">
											<div class="mt-3 mt-md-0 py-4 px-3">
												<h5 class="text-muted text-uppercase fs-13">Replication Factor</i>
												</h5>
												<div class="d-flex align-items-center">
													<div class="flex-shrink-0">
														<i class=" ri-file-copy-2-line display-6 text-muted"></i>
													</div>
													<div class="flex-grow-1 ms-3">
														<h2 class="mb-0"><span class="counter-value" th:data-target="${topic.getReplicationFactorCount()}">0</span></h2>
													</div>
												</div>
											</div>
										</div><!-- end col -->
										<div class="col col-lg border-end">
											<div class="mt-3 mt-md-0 py-4 px-3">
												<h5 class="text-muted text-uppercase fs-13">In sync Replicas</i>
												</h5>
												<div class="d-flex align-items-center">
													<div class="flex-shrink-0">
														<i class="ri-pulse-line display-6 text-muted"></i>
													</div>
													<div class="flex-grow-1 ms-3">
														<h2 class="mb-0"><span class="counter-value" th:data-target="${#aggregates.sum(topic.getPartitions.![getIsr().size()])}">0 </span> 
															<span> of </span><span class="counter-value" th:data-target="${#aggregates.sum(topic.getPartitions.![getReplicaNodes().size()])}"></span></h2>
													</div>
												</div>
											</div>
										</div><!-- end col -->
										<div class="col col-lg border-end">
											<div class="mt-3 mt-lg-0 py-4 px-3">
												<h5 class="text-muted text-uppercase fs-13">Segment Size / Count</i>
												</h5>
												<div class="d-flex align-items-center">
													<div class="flex-shrink-0">
														<i class="ri-install-fill display-6 text-muted"></i>
													</div>
													<div class="flex-grow-1 ms-3">
														<h2 class="mb-0"><span class="counter-value" th:data-target="${topic.getTotalReplicaMessageSize()}">0</span> GB </span>
															<span> / </span>
															<span class="counter-value" th:data-target="${#aggregates.sum(topic.getPartitions.![getIsr().size()])}"> </span>
														</h2>
													</div>
												</div>
											</div>
										</div><!-- end col -->
										<div class="col col-lg">
											<div class="mt-3 mt-lg-0 py-4 px-3">
												<h5 class="text-muted text-uppercase fs-13">Message Count</i>
												</h5>
												<div class="d-flex align-items-center">
													<div class="flex-shrink-0">
														<i class="ri-message-3-line display-6 text-muted"></i>
													</div>
													<div class="flex-grow-1 ms-3">
														<h2 class="mb-0"><span class="counter-value" th:data-target="${topic.getTotalMessageCount()}">0</span></h2>
													</div>
												</div>
											</div>
										</div><!-- end col -->
									</div><!-- end row -->
								</div><!-- end card body -->
							</div><!-- end card -->
						</div><!-- end col -->
					</div><!-- end row -->
					<!-- Small Tables -->
					<table class="table table-sm table-nowrap">
						<thead>
							<tr>
								<th scope="col">Partition ID</th>
								<th scope="col">Replicas</th>
								<th scope="col">First Offset</th>
								<th scope="col">Commited Offset</th>
								<th scope="col">Message Count</th>
							</tr>
						</thead>
						<tbody th:each="partition : ${topic.getPartitions()}">
							<tr>
								<th scope="row" th:text="${partition.getPartitionId()}"></th>
								<td th:text="${partition.getReplicas().size()}"></td>
								<td th:text="${partition.getPartitionsOffset().getEarliestOffSet()}"></td>
								<td th:text="${partition.getPartitionsOffset().getCommittedOffset()}"></td>
								<td th:text="${partition.getPartitionsOffset().totalMessageCount()}"></td>
							</tr>
						</tbody>
					</table>
				</div>
				<!-- end Partitions -->
				<!--Metrics-->
				<div class="tab-pane" id="topic-dashboard-nav-metrics" role="tabpanel">
					<table class="table table-sm table-nowrap">
						<thead>
							<tr>
								<th scope="col">Partition ID</th>
								<th scope="col">Replicas</th>
								<th scope="col">First Offset</th>
								<th scope="col">Commited Offset</th>
								<th scope="col">Message Count</th>
							</tr>
						</thead>
						<tbody th:each="partition : ${topic.getPartitions()}">
							<tr>
								<th scope="row" th:text="${partition.getPartitionId()}"></th>
								<td th:text="${partition.getReplicas().size()}"></td>
								<td th:text="${partition.getPartitionsOffset().getEarliestOffSet()}"></td>
								<td th:text="${partition.getPartitionsOffset().getCommittedOffset()}"></td>
								<td th:text="${partition.getPartitionsOffset().totalMessageCount()}"></td>
							</tr>
						</tbody>
					</table>
				</div>
				<!-- end Metrics -->
			</div>
		</div>
		<!-- end row -->

	</div>
	
	<th:block layout:fragment="pagejs">

		<!-- apexcharts -->
		<script src="/assets/libs/apexcharts/apexcharts.min.js"></script>
		<!--Modal init-->
		<script src="/assets/js/pages/kafka/kafka-modal-init.js"></script>
		<!--Kafka chart init-->
		<script src="/assets/js/pages/kafka/kafka-charts-init.js"></script>
		<script src="/assets/js/pages/kafka/kafka-form.js"></script>
	</th:block>
</body>

</html>